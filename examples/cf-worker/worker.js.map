{
  "version": 3,
  "sources": ["node_modules/@friendsofshopware/app-server-sdk/esm/registration.js", "node_modules/@friendsofshopware/app-server-sdk/esm/http-client.js", "node_modules/@friendsofshopware/app-server-sdk/esm/context-resolver.js", "node_modules/@friendsofshopware/app-server-sdk/esm/app.js", "node_modules/@friendsofshopware/app-server-sdk/esm/signer.js", "node_modules/@friendsofshopware/app-server-sdk-cloudflare/node_modules/@friendsofshopware/app-server-sdk/esm/repository.js", "node_modules/@friendsofshopware/app-server-sdk-cloudflare/esm/mod.js", "src/index.ts"],
  "sourceRoot": "/",
  "sourcesContent": ["export class Registration {\n    constructor(app) {\n        Object.defineProperty(this, \"app\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: app\n        });\n    }\n    async authorize(req) {\n        const url = new URL(req.url);\n        if (!url.searchParams.has(\"shop-url\") ||\n            !req.headers.has(\"shopware-app-signature\") ||\n            !url.searchParams.has(\"shop-id\") ||\n            !url.searchParams.has(\"timestamp\")) {\n            throw new Error(\"Invalid Request\");\n        }\n        const v = await this.app.signer.verify(req.headers.get(\"shopware-app-signature\"), `shop-id=${url.searchParams.get(\"shop-id\")}&shop-url=${url.searchParams.get(\"shop-url\")}&timestamp=${url.searchParams.get(\"timestamp\")}`, this.app.cfg.appSecret);\n        if (!v) {\n            throw new Error(\"Cannot validate app signature\");\n        }\n        const shop = this.app.repository.createShopStruct(url.searchParams.get(\"shop-id\"), url.searchParams.get(\"shop-url\"), randomString());\n        await this.app.repository.createShop(shop);\n        return new Response(JSON.stringify({\n            proof: await this.app.signer.sign(shop.getShopId() + shop.getShopUrl() + this.app.cfg.appName, this.app.cfg.appSecret),\n            secret: shop.getShopSecret(),\n            confirmation_url: this.app.cfg.authorizeCallbackUrl,\n        }), {\n            headers: {\n                \"content-type\": \"application/json\",\n            },\n        });\n    }\n    async authorizeCallback(req) {\n        const bodyContent = await req.text();\n        const body = JSON.parse(bodyContent);\n        if (typeof body.shopId !== \"string\" || typeof body.apiKey !== \"string\" ||\n            typeof body.secretKey !== \"string\" ||\n            !req.headers.has(\"shopware-shop-signature\")) {\n            throw new Error(\"Invalid Request\");\n        }\n        const shop = await this.app.repository.getShopById(body.shopId);\n        if (shop === null) {\n            throw new Error(`Cannot find shop for this id: ${body.shopId}`);\n        }\n        const v = await this.app.signer.verify(req.headers.get(\"shopware-shop-signature\"), bodyContent, shop.getShopSecret());\n        if (!v) {\n            // Shop has failed the verify. Delete it from our DB\n            await this.app.repository.deleteShop(shop.getShopId());\n            throw new Error(\"Cannot validate app signature\");\n        }\n        shop.setShopCredentials(body.apiKey, body.secretKey);\n        await this.app.repository.updateShop(shop);\n        return new Response(null, { status: 204 });\n    }\n}\nexport function randomString() {\n    const f = () => Math.random().toString(36).substring(2);\n    return f() + f();\n}\n", "export class HttpClient {\n    constructor(shop) {\n        Object.defineProperty(this, \"shop\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: shop\n        });\n        Object.defineProperty(this, \"storage\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.storage = {\n            token: null,\n            expiresIn: null,\n        };\n    }\n    async get(url, headers = {}) {\n        return await this.request(\"GET\", url, null, headers);\n    }\n    async post(url, json = {}, headers = {}) {\n        headers[\"content-type\"] = \"application/json\";\n        headers[\"accept\"] = \"application/json\";\n        return await this.request(\"POST\", url, JSON.stringify(json), headers);\n    }\n    async put(url, json = {}, headers = {}) {\n        headers[\"content-type\"] = \"application/json\";\n        headers[\"accept\"] = \"application/json\";\n        return await this.request(\"PUT\", url, JSON.stringify(json), headers);\n    }\n    async patch(url, json = {}, headers = {}) {\n        headers[\"content-type\"] = \"application/json\";\n        headers[\"accept\"] = \"application/json\";\n        return await this.request(\"PATCH\", url, JSON.stringify(json), headers);\n    }\n    async delete(url, json = {}, headers = {}) {\n        headers[\"content-type\"] = \"application/json\";\n        headers[\"accept\"] = \"application/json\";\n        return await this.request(\"DELETE\", url, JSON.stringify(json), headers);\n    }\n    async request(method, url, body = \"\", headers = {}) {\n        const fHeaders = Object.assign({}, headers);\n        fHeaders[\"Authorization\"] = `Bearer ${await this.getToken()}`;\n        const f = await globalThis.fetch(`${this.shop.getShopUrl()}/api${url}`, {\n            body,\n            headers: fHeaders,\n            method,\n        });\n        // Obtain new token\n        if (!f.ok && f.status === 401) {\n            this.storage.expiresIn = null;\n            return await this.request(method, url, body, headers);\n        }\n        else if (!f.ok) {\n            throw new ApiClientRequestFailed(this.shop.getShopId(), new HttpClientResponse(f.status, await f.json(), f.headers));\n        }\n        if (f.status === 204) {\n            return new HttpClientResponse(f.status, {}, f.headers);\n        }\n        return new HttpClientResponse(f.status, await f.json(), f.headers);\n    }\n    async getToken() {\n        if (this.storage.expiresIn === null) {\n            const auth = await globalThis.fetch(`${this.shop.getShopUrl()}/api/oauth/token`, {\n                method: \"POST\",\n                headers: {\n                    \"content-type\": \"application/json\",\n                },\n                body: JSON.stringify({\n                    grant_type: \"client_credentials\",\n                    client_id: this.shop.getShopClientId(),\n                    client_secret: this.shop.getShopClientSecret(),\n                }),\n            });\n            if (!auth.ok) {\n                throw new ApiClientAuthenticationFailed(this.shop.getShopId(), new HttpClientResponse(auth.status, await auth.json(), auth.headers));\n            }\n            const expireDate = new Date();\n            const authBody = await auth.json();\n            this.storage.token = authBody.access_token;\n            expireDate.setSeconds(expireDate.getSeconds() + authBody.expires_in);\n            this.storage.expiresIn = expireDate;\n            return this.storage.token;\n        }\n        if (this.storage.expiresIn.getTime() < (new Date()).getTime()) {\n            // Expired\n            this.storage.expiresIn = null;\n            return await this.getToken();\n        }\n        return this.storage.token;\n    }\n}\nexport class HttpClientResponse {\n    constructor(statusCode, body, headers) {\n        Object.defineProperty(this, \"statusCode\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: statusCode\n        });\n        Object.defineProperty(this, \"body\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: body\n        });\n        Object.defineProperty(this, \"headers\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: headers\n        });\n    }\n}\nexport class ApiClientAuthenticationFailed extends Error {\n    constructor(shopId, response) {\n        super(`The api client authentication to shop with id: ${shopId}`);\n        Object.defineProperty(this, \"response\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: response\n        });\n    }\n}\nexport class ApiClientRequestFailed extends Error {\n    constructor(shopId, response) {\n        super(`The api request failed with status code: ${response.statusCode} for shop with id: ${shopId}`);\n        Object.defineProperty(this, \"response\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: response\n        });\n    }\n}\n", "import { HttpClient } from \"./http-client.js\";\nexport class ContextResolver {\n    constructor(app) {\n        Object.defineProperty(this, \"app\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: app\n        });\n    }\n    async fromSource(req) {\n        const webHookContent = await req.text();\n        const webHookBody = JSON.parse(webHookContent);\n        const shop = await this.app.repository.getShopById(webHookBody.source.shopId);\n        if (shop === null) {\n            throw new Error(`Cannot find shop by id ${webHookBody.source.shopId}`);\n        }\n        await this.app.signer.verify(req.headers.get(\"shopware-shop-signature\"), webHookContent, shop.getShopSecret());\n        return new Context(shop, webHookBody, new HttpClient(shop));\n    }\n    async fromModule(req) {\n        const url = new URL(req.url);\n        const shop = await this.app.repository.getShopById(url.searchParams.get(\"shop-id\"));\n        if (shop === null) {\n            throw new Error(`Cannot find shop by id ${url.searchParams.get(\"shop-id\")}`);\n        }\n        await this.app.signer.verifyGetRequest(req, shop.getShopSecret());\n        const paramsObject = {};\n        url.searchParams.forEach((value, key) => {\n            paramsObject[key] = value;\n        });\n        return new Context(shop, paramsObject, new HttpClient(shop));\n    }\n}\nclass Context {\n    constructor(shop, payload, httpClient) {\n        Object.defineProperty(this, \"shop\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: shop\n        });\n        Object.defineProperty(this, \"payload\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: payload\n        });\n        Object.defineProperty(this, \"httpClient\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: httpClient\n        });\n    }\n}\n", "import { Registration } from \"./registration.js\";\nimport { ContextResolver } from \"./context-resolver.js\";\nexport class AppServer {\n    constructor(cfg, repository, signer) {\n        Object.defineProperty(this, \"cfg\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: cfg\n        });\n        Object.defineProperty(this, \"repository\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: repository\n        });\n        Object.defineProperty(this, \"signer\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: signer\n        });\n        Object.defineProperty(this, \"registration\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"contextResolver\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.registration = new Registration(this);\n        this.contextResolver = new ContextResolver(this);\n    }\n}\n", "export class AbstractHmacSigner {\n    async signResponse(response, secret) {\n        response.headers.set(\"shopware-app-signature\", await this.sign(await response.text(), secret));\n    }\n    async verifyGetRequest(request, secret) {\n        const url = new URL(request.url);\n        const signature = url.searchParams.get(\"shopware-shop-signature\");\n        url.searchParams.delete(\"shopware-shop-signature\");\n        return await this.verify(signature, url.searchParams.toString(), secret);\n    }\n}\nexport class WebCryptoHmacSigner extends AbstractHmacSigner {\n    constructor() {\n        super();\n        Object.defineProperty(this, \"encoder\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"keyCache\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.encoder = new TextEncoder();\n        this.keyCache = new Map();\n    }\n    async getKeyForSecret(secret) {\n        if (this.keyCache.has(secret)) {\n            return this.keyCache.get(secret);\n        }\n        const secretKeyData = this.encoder.encode(secret);\n        const key = await crypto.subtle.importKey(\"raw\", secretKeyData, { name: \"HMAC\", hash: \"SHA-256\" }, false, [\"sign\", \"verify\"]);\n        this.keyCache.set(secret, key);\n        return key;\n    }\n    async sign(message, secret) {\n        const key = await this.getKeyForSecret(secret);\n        const mac = await crypto.subtle.sign(\"HMAC\", key, this.encoder.encode(message));\n        return this.buf2hex(mac);\n    }\n    async verify(signature, data, secret) {\n        const signed = await this.sign(data, secret);\n        return signature === signed;\n    }\n    buf2hex(buf) {\n        return Array.prototype.map.call(new Uint8Array(buf), (x) => ((\"00\" + x.toString(16)).slice(-2))).join(\"\");\n    }\n}\n", "export class SimpleShop {\n    constructor(shopId, shopUrl, shopSecret) {\n        Object.defineProperty(this, \"shopId\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"shopUrl\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"shopSecret\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"shopClientId\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"shopClientSecret\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.shopId = shopId;\n        this.shopUrl = shopUrl;\n        this.shopSecret = shopSecret;\n        this.shopClientId = null;\n        this.shopClientSecret = null;\n    }\n    getShopId() {\n        return this.shopId;\n    }\n    getShopUrl() {\n        return this.shopUrl;\n    }\n    getShopSecret() {\n        return this.shopSecret;\n    }\n    getShopClientId() {\n        return this.shopClientId;\n    }\n    getShopClientSecret() {\n        return this.shopClientSecret;\n    }\n    setShopCredentials(clientId, clientSecret) {\n        this.shopClientId = clientId;\n        this.shopClientSecret = clientSecret;\n    }\n}\nexport class InMemoryShopRepository {\n    constructor() {\n        Object.defineProperty(this, \"storage\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.storage = new Map();\n    }\n    createShopStruct(shopId, shopUrl, shopSecret) {\n        return new SimpleShop(shopId, shopUrl, shopSecret);\n    }\n    async createShop(shop) {\n        this.storage.set(shop.getShopId(), shop);\n    }\n    async getShopById(id) {\n        if (this.storage.has(id)) {\n            return this.storage.get(id);\n        }\n        return null;\n    }\n    async updateShop(shop) {\n        await this.createShop(shop);\n    }\n    async deleteShop(id) {\n        this.storage.delete(id);\n    }\n}\n", "import { SimpleShop } from \"@friendsofshopware/app-server-sdk\";\nexport class CloudflareShopRepository {\n    // dnt-shim-ignore\n    constructor(storage) {\n        Object.defineProperty(this, \"storage\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: storage\n        });\n        this.storage = storage;\n    }\n    createShopStruct(shopId, shopUrl, shopSecret) {\n        return new SimpleShop(shopId, shopUrl, shopSecret);\n    }\n    async createShop(shop) {\n        await this.storage.put(shop.getShopId(), this.serializeShop(shop));\n    }\n    async deleteShop(id) {\n        await this.storage.delete(id);\n    }\n    async getShopById(id) {\n        const kvObj = await this.storage.get(id);\n        if (kvObj === null) {\n            return null;\n        }\n        return this.deserializeShop(kvObj);\n    }\n    async updateShop(shop) {\n        return await this.createShop(shop);\n    }\n    serializeShop(shop) {\n        return JSON.stringify(shop);\n    }\n    deserializeShop(data) {\n        const obj = JSON.parse(data);\n        const shop = new SimpleShop(obj.shopId || \"\", obj.shopUrl || \"\", obj.shopSecret || \"\");\n        shop.setShopCredentials(obj.clientId || \"\", obj.clientSecret || \"\");\n        return shop;\n    }\n}\n", "import {AppServer, AppConfigurationInterface, WebCryptoHmacSigner} from \"@friendsofshopware/app-server-sdk\";\r\nimport {CloudflareShopRepository} from \"@friendsofshopware/app-server-sdk-cloudflare\";\r\n\r\nconst cfg: AppConfigurationInterface = {\r\n    appName: 'Test',\r\n    appSecret: 'testSecret',\r\n    authorizeCallbackUrl: 'https://xxxx.shyim.workers.dev/authorize/callback'\r\n};\r\n\r\ninterface Env {\r\n  shopStorage: KVNamespace\r\n}\r\n\r\nexport default {\r\n  async fetch(request: Request, env: Env): Promise<Response> {\r\n    const url = new URL(request.url);\r\n\r\n    const app = new AppServer(cfg, new CloudflareShopRepository(env.shopStorage), new WebCryptoHmacSigner());\r\n\r\n    if (url.pathname.startsWith('/authorize/callback')) {\r\n        return await app.registration.authorizeCallback(request);\r\n    }\r\n\r\n    if (url.pathname.startsWith('/authorize')) {\r\n        return await app.registration.authorize(request);\r\n    }\r\n\r\n    return new Response(`Not found`)\r\n  }\r\n}"],
  "mappings": "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",
  "names": ["Registration", "app", "req", "url", "shop", "randomString", "bodyContent", "body", "f", "HttpClient", "shop", "url", "headers", "json", "method", "body", "fHeaders", "f", "ApiClientRequestFailed", "HttpClientResponse", "auth", "ApiClientAuthenticationFailed", "expireDate", "authBody", "statusCode", "shopId", "response", "ContextResolver", "app", "req", "webHookContent", "webHookBody", "shop", "Context", "HttpClient", "url", "paramsObject", "value", "key", "payload", "httpClient", "AppServer", "cfg", "repository", "signer", "Registration", "ContextResolver", "AbstractHmacSigner", "response", "secret", "request", "url", "signature", "WebCryptoHmacSigner", "secretKeyData", "key", "message", "mac", "data", "signed", "buf", "x", "SimpleShop", "shopId", "shopUrl", "shopSecret", "clientId", "clientSecret", "CloudflareShopRepository", "storage", "shopId", "shopUrl", "shopSecret", "SimpleShop", "shop", "id", "kvObj", "data", "obj", "cfg", "src_default", "request", "env", "url", "app", "AppServer", "CloudflareShopRepository", "WebCryptoHmacSigner"]
}
